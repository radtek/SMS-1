DELETE FROM "UserAccountLoginSessionData"
WHERE "UserAccountID" NOT IN (
 	SELECT ualsd."UserAccountID"
	FROM "UserAccountLoginSessionData" ualsd
	JOIN "UserAccounts" ua ON ualsd."UserAccountID" = ua."ID"
);

DELETE FROM "UserAccountLoginSession"
WHERE "UserSessionID" NOT IN (
 	SELECT uals."UserSessionID"
	FROM "UserAccountLoginSession" uals
	JOIN "UserAccounts" ua ON uals."UserAccountID" = ua."ID"
);

ALTER TABLE public."UserAccountLoginSession"
  ADD CONSTRAINT "UserAccountLoginSession_UserAccounts_fk" FOREIGN KEY ("UserAccountID")
    REFERENCES public."UserAccounts"("ID")
    ON DELETE NO ACTION
    ON UPDATE NO ACTION
    NOT DEFERRABLE;

	
UPDATE "NotificationConstructData" AS ncd
SET "NotificationData" = E'<?xml version="1.0" encoding="utf-8" standalone="yes"?>\\015\\012<StiSerializer version="1.02" type="Net" application="StiReport">\\015\\012  <Dictionary Ref="1" type="Dictionary" isKey="true">\\015\\012    <BusinessObjects isList="true" count="2">\\015\\012      <NotificationSettingDTO Ref="2" type="Stimulsoft.Report.Dictionary.StiBusinessObject" isKey="true">\\015\\012        <Alias>NotificationSettingDTO</Alias>\\015\\012        <BusinessObjects isList="true" count="0" />\\015\\012        <Category>General</Category>\\015\\012        <Columns isList="true" count="11">\\015\\012          <value>ExportFormat,System.Nullable`1[System.Int32]</value>\\015\\012          <value>LoginRoute,System.String</value>\\015\\012          <value>NotificationConstructID,System.Guid</value>\\015\\012          <value>NotificationConstructVersionNumber,System.Int32</value>\\015\\012          <value>NotificationFromEmailAddress,System.String</value>\\015\\012          <value>NotificiationSentFromParentID,System.Guid</value>\\015\\012          <value>ServerLogoImageFileNameWithExtension,System.String</value>\\015\\012          <value>ServerNotificationImageContentURLFolder,System.String</value>\\015\\012          <value>ServerURL,System.String</value>\\015\\012          <value>Subject,System.String</value>\\015\\012          <value>Title,System.String</value>\\015\\012        </Columns>\\015\\012        <Dictionary isRef="1" />\\015\\012        <Guid>1926f055d4144572b36e7a96e6843d70</Guid>\\015\\012        <Name>NotificationSettingDTO</Name>\\015\\012      </NotificationSettingDTO>\\015\\012      <NewInternalMessagesNotificationDTO Ref="3" type="Stimulsoft.Report.Dictionary.StiBusinessObject" isKey="true">\\015\\012        <Alias>NewInternalMessagesNotificationDTO</Alias>\\015\\012        <BusinessObjects isList="true" count="0" />\\015\\012        <Category>General</Category>\\015\\012        <Columns isList="true" count="2">\\015\\012          <value>Count,System.Int32</value>\\015\\012          <value>ProductName,System.String</value>\\015\\012        </Columns>\\015\\012        <Dictionary isRef="1" />\\015\\012        <Guid>9c462515737f4adeb65f3562c03c20d5</Guid>\\015\\012        <Name>NewInternalMessagesNotificationDTO</Name>\\015\\012      </NewInternalMessagesNotificationDTO>\\015\\012    </BusinessObjects>\\015\\012    <Databases isList="true" count="0" />\\015\\012    <DataSources isList="true" count="0" />\\015\\012    <Relations isList="true" count="0" />\\015\\012    <Report isRef="0" />\\015\\012    <Variables isList="true" count="0" />\\015\\012  </Dictionary>\\015\\012  <EngineVersion>EngineV2</EngineVersion>\\015\\012  <GlobalizationStrings isList="true" count="0" />\\015\\012  <MetaTags isList="true" count="0" />\\015\\012  <Pages isList="true" count="1">\\015\\012    <Page1 Ref="4" type="Page" isKey="true">\\015\\012      <Border>None;Black;2;Solid;False;4;Black</Border>\\015\\012      <Brush>Transparent</Brush>\\015\\012      <Components isList="true" count="1">\\015\\012        <Text Ref="5" type="Text" isKey="true">\\015\\012          <AllowHtmlTags>True</AllowHtmlTags>\\015\\012          <AutoWidth>True</AutoWidth>\\015\\012          <Brush>Transparent</Brush>\\015\\012          <CanGrow>True</CanGrow>\\015\\012          <CanShrink>True</CanShrink>\\015\\012          <ClientRectangle>0,0,38,9.4</ClientRectangle>\\015\\012          <Conditions isList="true" count="0" />\\015\\012          <Font>Calibri,11.25,Regular,Point,False,0</Font>\\015\\012          <GrowToHeight>True</GrowToHeight>\\015\\012          <Guid>aec152f25a8e4fdbb05d29af446e8573</Guid>\\015\\012          <Margins>0,0,0,0</Margins>\\015\\012          <Name>Text</Name>\\015\\012          <Page isRef="4" />\\015\\012          <Parent isRef="4" />\\015\\012          <Text>&lt;p&gt;You have a new notification in the {NewInternalMessagesNotificationDTO.ProductName}.&lt;/p&gt;\\015\\012&lt;p&gt;&lt;b&gt;Please log into the Safe Move Scheme secure website portal as described in the Safe Move Scheme Login Security Policy.&lt;/b&gt;&lt;/p&gt;\\015\\012&lt;p&gt;Kind regards,&lt;/p&gt;\\015\\012&lt;p&gt;The {NewInternalMessagesNotificationDTO.ProductName}&lt;/p&gt;</Text>\\015\\012          <TextBrush>Black</TextBrush>\\015\\012          <TextQuality>Wysiwyg</TextQuality>\\015\\012          <Type>Expression</Type>\\015\\012        </Text>\\015\\012      </Components>\\015\\012      <Conditions isList="true" count="0" />\\015\\012      <Guid>3f4c07272ec54ccaae2496d9fb03c747</Guid>\\015\\012      <Margins>1,1,1,1</Margins>\\015\\012      <Name>Page1</Name>\\015\\012      <Orientation>Landscape</Orientation>\\015\\012      <PageHeight>29.7</PageHeight>\\015\\012      <PageWidth>40</PageWidth>\\015\\012      <Report isRef="0" />\\015\\012      <StretchToPrintArea>True</StretchToPrintArea>\\015\\012      <Watermark Ref="6" type="Stimulsoft.Report.Components.StiWatermark" isKey="true">\\015\\012        <Font>Arial,100</Font>\\015\\012        <TextBrush>[50:0:0:0]</TextBrush>\\015\\012      </Watermark>\\015\\012    </Page1>\\015\\012  </Pages>\\015\\012  <PrinterSettings Ref="7" type="Stimulsoft.Report.Print.StiPrinterSettings" isKey="true" />\\015\\012  <ReferencedAssemblies isList="true" count="8">\\015\\012    <value>System.Dll</value>\\015\\012    <value>System.Drawing.Dll</value>\\015\\012    <value>System.Windows.Forms.Dll</value>\\015\\012    <value>System.Data.Dll</value>\\015\\012    <value>System.Xml.Dll</value>\\015\\012    <value>Stimulsoft.Controls.Dll</value>\\015\\012    <value>Stimulsoft.Base.Dll</value>\\015\\012    <value>Stimulsoft.Report.Dll</value>\\015\\012  </ReferencedAssemblies>\\015\\012  <ReportAlias>Report</ReportAlias>\\015\\012  <ReportChanged>10/30/2015 12:06:23 PM</ReportChanged>\\015\\012  <ReportCreated>9/28/2015 10:50:12 AM</ReportCreated>\\015\\012  <ReportFile>AddNewInternalMessagesNotification.mrt</ReportFile>\\015\\012  <ReportGuid>300413c090cc4841b190b03878091ce5</ReportGuid>\\015\\012  <ReportName>Report</ReportName>\\015\\012  <ReportUnit>Centimeters</ReportUnit>\\015\\012  <ReportVersion>2014.3.0</ReportVersion>\\015\\012  <Script>using System;\\015\\012using System.Drawing;\\015\\012using System.Windows.Forms;\\015\\012using System.Data;\\015\\012using Stimulsoft.Controls;\\015\\012using Stimulsoft.Base.Drawing;\\015\\012using Stimulsoft.Report;\\015\\012using Stimulsoft.Report.Dialogs;\\015\\012using Stimulsoft.Report.Components;\\015\\012\\015\\012namespace Reports\\015\\012{\\015\\012    public class Report : Stimulsoft.Report.StiReport\\015\\012    {\\015\\012        public Report()        {\\015\\012            this.InitializeComponent();\\015\\012        }\\015\\012\\015\\012        #region StiReport Designer generated code - do not modify\\015\\012\\011\\011#endregion StiReport Designer generated code - do not modify\\015\\012    }\\015\\012}\\015\\012</Script>\\015\\012  <ScriptLanguage>CSharp</ScriptLanguage>\\015\\012  <Styles isList="true" count="0" />\\015\\012</StiSerializer>'
WHERE EXISTS(
	SELECT * 
    FROM "NotificationConstruct" AS nc
	WHERE ncd."NotificationConstructID" = nc."NotificationConstructID" AND nc."Name" LIKE 'NewInternalMessages');

UPDATE "NotificationConstructDataTemplate" AS ncdt
SET "NotificationData" = E'<?xml version="1.0" encoding="utf-8" standalone="yes"?>\\015\\012<StiSerializer version="1.02" type="Net" application="StiReport">\\015\\012  <Dictionary Ref="1" type="Dictionary" isKey="true">\\015\\012    <BusinessObjects isList="true" count="2">\\015\\012      <NotificationSettingDTO Ref="2" type="Stimulsoft.Report.Dictionary.StiBusinessObject" isKey="true">\\015\\012        <Alias>NotificationSettingDTO</Alias>\\015\\012        <BusinessObjects isList="true" count="0" />\\015\\012        <Category>General</Category>\\015\\012        <Columns isList="true" count="11">\\015\\012          <value>ExportFormat,System.Nullable`1[System.Int32]</value>\\015\\012          <value>LoginRoute,System.String</value>\\015\\012          <value>NotificationConstructID,System.Guid</value>\\015\\012          <value>NotificationConstructVersionNumber,System.Int32</value>\\015\\012          <value>NotificationFromEmailAddress,System.String</value>\\015\\012          <value>NotificiationSentFromParentID,System.Guid</value>\\015\\012          <value>ServerLogoImageFileNameWithExtension,System.String</value>\\015\\012          <value>ServerNotificationImageContentURLFolder,System.String</value>\\015\\012          <value>ServerURL,System.String</value>\\015\\012          <value>Subject,System.String</value>\\015\\012          <value>Title,System.String</value>\\015\\012        </Columns>\\015\\012        <Dictionary isRef="1" />\\015\\012        <Guid>1926f055d4144572b36e7a96e6843d70</Guid>\\015\\012        <Name>NotificationSettingDTO</Name>\\015\\012      </NotificationSettingDTO>\\015\\012      <NewInternalMessagesNotificationDTO Ref="3" type="Stimulsoft.Report.Dictionary.StiBusinessObject" isKey="true">\\015\\012        <Alias>NewInternalMessagesNotificationDTO</Alias>\\015\\012        <BusinessObjects isList="true" count="0" />\\015\\012        <Category>General</Category>\\015\\012        <Columns isList="true" count="2">\\015\\012          <value>Count,System.Int32</value>\\015\\012          <value>ProductName,System.String</value>\\015\\012        </Columns>\\015\\012        <Dictionary isRef="1" />\\015\\012        <Guid>9c462515737f4adeb65f3562c03c20d5</Guid>\\015\\012        <Name>NewInternalMessagesNotificationDTO</Name>\\015\\012      </NewInternalMessagesNotificationDTO>\\015\\012    </BusinessObjects>\\015\\012    <Databases isList="true" count="0" />\\015\\012    <DataSources isList="true" count="0" />\\015\\012    <Relations isList="true" count="0" />\\015\\012    <Report isRef="0" />\\015\\012    <Variables isList="true" count="0" />\\015\\012  </Dictionary>\\015\\012  <EngineVersion>EngineV2</EngineVersion>\\015\\012  <GlobalizationStrings isList="true" count="0" />\\015\\012  <MetaTags isList="true" count="0" />\\015\\012  <Pages isList="true" count="1">\\015\\012    <Page1 Ref="4" type="Page" isKey="true">\\015\\012      <Border>None;Black;2;Solid;False;4;Black</Border>\\015\\012      <Brush>Transparent</Brush>\\015\\012      <Components isList="true" count="1">\\015\\012        <Text Ref="5" type="Text" isKey="true">\\015\\012          <AllowHtmlTags>True</AllowHtmlTags>\\015\\012          <AutoWidth>True</AutoWidth>\\015\\012          <Brush>Transparent</Brush>\\015\\012          <CanGrow>True</CanGrow>\\015\\012          <CanShrink>True</CanShrink>\\015\\012          <ClientRectangle>0,0,38,9.4</ClientRectangle>\\015\\012          <Conditions isList="true" count="0" />\\015\\012          <Font>Calibri,11.25,Regular,Point,False,0</Font>\\015\\012          <GrowToHeight>True</GrowToHeight>\\015\\012          <Guid>aec152f25a8e4fdbb05d29af446e8573</Guid>\\015\\012          <Margins>0,0,0,0</Margins>\\015\\012          <Name>Text</Name>\\015\\012          <Page isRef="4" />\\015\\012          <Parent isRef="4" />\\015\\012          <Text>&lt;p&gt;You have a new notification in the {NewInternalMessagesNotificationDTO.ProductName}.&lt;/p&gt;\\015\\012&lt;p&gt;&lt;b&gt;Please log into the Safe Move Scheme secure website portal as described in the Safe Move Scheme Login Security Policy.&lt;/b&gt;&lt;/p&gt;\\015\\012&lt;p&gt;Kind regards,&lt;/p&gt;\\015\\012&lt;p&gt;The {NewInternalMessagesNotificationDTO.ProductName}&lt;/p&gt;</Text>\\015\\012          <TextBrush>Black</TextBrush>\\015\\012          <TextQuality>Wysiwyg</TextQuality>\\015\\012          <Type>Expression</Type>\\015\\012        </Text>\\015\\012      </Components>\\015\\012      <Conditions isList="true" count="0" />\\015\\012      <Guid>3f4c07272ec54ccaae2496d9fb03c747</Guid>\\015\\012      <Margins>1,1,1,1</Margins>\\015\\012      <Name>Page1</Name>\\015\\012      <Orientation>Landscape</Orientation>\\015\\012      <PageHeight>29.7</PageHeight>\\015\\012      <PageWidth>40</PageWidth>\\015\\012      <Report isRef="0" />\\015\\012      <StretchToPrintArea>True</StretchToPrintArea>\\015\\012      <Watermark Ref="6" type="Stimulsoft.Report.Components.StiWatermark" isKey="true">\\015\\012        <Font>Arial,100</Font>\\015\\012        <TextBrush>[50:0:0:0]</TextBrush>\\015\\012      </Watermark>\\015\\012    </Page1>\\015\\012  </Pages>\\015\\012  <PrinterSettings Ref="7" type="Stimulsoft.Report.Print.StiPrinterSettings" isKey="true" />\\015\\012  <ReferencedAssemblies isList="true" count="8">\\015\\012    <value>System.Dll</value>\\015\\012    <value>System.Drawing.Dll</value>\\015\\012    <value>System.Windows.Forms.Dll</value>\\015\\012    <value>System.Data.Dll</value>\\015\\012    <value>System.Xml.Dll</value>\\015\\012    <value>Stimulsoft.Controls.Dll</value>\\015\\012    <value>Stimulsoft.Base.Dll</value>\\015\\012    <value>Stimulsoft.Report.Dll</value>\\015\\012  </ReferencedAssemblies>\\015\\012  <ReportAlias>Report</ReportAlias>\\015\\012  <ReportChanged>10/30/2015 12:06:23 PM</ReportChanged>\\015\\012  <ReportCreated>9/28/2015 10:50:12 AM</ReportCreated>\\015\\012  <ReportFile>AddNewInternalMessagesNotification.mrt</ReportFile>\\015\\012  <ReportGuid>300413c090cc4841b190b03878091ce5</ReportGuid>\\015\\012  <ReportName>Report</ReportName>\\015\\012  <ReportUnit>Centimeters</ReportUnit>\\015\\012  <ReportVersion>2014.3.0</ReportVersion>\\015\\012  <Script>using System;\\015\\012using System.Drawing;\\015\\012using System.Windows.Forms;\\015\\012using System.Data;\\015\\012using Stimulsoft.Controls;\\015\\012using Stimulsoft.Base.Drawing;\\015\\012using Stimulsoft.Report;\\015\\012using Stimulsoft.Report.Dialogs;\\015\\012using Stimulsoft.Report.Components;\\015\\012\\015\\012namespace Reports\\015\\012{\\015\\012    public class Report : Stimulsoft.Report.StiReport\\015\\012    {\\015\\012        public Report()        {\\015\\012            this.InitializeComponent();\\015\\012        }\\015\\012\\015\\012        #region StiReport Designer generated code - do not modify\\015\\012\\011\\011#endregion StiReport Designer generated code - do not modify\\015\\012    }\\015\\012}\\015\\012</Script>\\015\\012  <ScriptLanguage>CSharp</ScriptLanguage>\\015\\012  <Styles isList="true" count="0" />\\015\\012</StiSerializer>'
WHERE EXISTS(
	SELECT * 
    FROM "NotificationConstructTemplate" AS nct
	WHERE ncdt."NotificationConstructTemplateID" = nct."NotificationConstructTemplateID" AND nct."Name" LIKE 'NewInternalMessages');