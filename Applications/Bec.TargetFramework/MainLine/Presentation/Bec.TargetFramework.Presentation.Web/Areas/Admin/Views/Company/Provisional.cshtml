@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- MAIN CONTENT -->
<div id="content">
    <div class="row">
        <h2 class="row-seperator-header"> View Provisional Companies </h2>
        <hr class="simple">
        <div class="col-sm-12">
            <!-- Widget ID (each widget will need unique ID)-->

            <ul id="myTab1" class="nav nav-tabs bordered" role="tablist">
                <li><a href="#s1"> Unverified </a></li>
                <li><a href="#s2"> Verified </a></li>
                <li><a href="#s3"> Rejected </a></li>
            </ul>
            <div id="myTabContent1" class="tab-content padding-10">
                <div class="tab-pane fade in active" id="s1" role="tabpanel">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="well">
                                <a data-href="@Url.Action("ViewAddTempCompany","Company",new {area  = "Admin"})" class="btn btn-primary btn-sm" data-modallink="true">Add Company</a>
                            </div>
                            <div class="well">
                                <div id="unverifiedGrid"></div>
                            </div>
                        </div>
                    </div>

                    <div class="row hidden" id="unverifiedPanel">
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <a id="rejectButton" class="btn btn-primary btn-sm" data-modallink="true">Reject Company</a>
                                <a id="pinButton" class="btn btn-primary btn-sm" data-modallink="true">Generate PIN</a>
                                <a id="uEmailLogButton" class="btn btn-primary btn-sm" data-modallink="true">View Email Log</a>
                                <h5>Company</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="dduCompanyName"></p></dd>
                                    <dt>Address:</dt>
                                    <dd><p id="dduCompanyAddress1"></p></dd>
                                    <dd><p id="dduCompanyAddress2"></p></dd>
                                    <dd><p id="dduCompanyTownCity"></p></dd>
                                    <dd><p id="dduCompanyCounty"></p></dd>
                                    <dd><p id="dduCompanyPostCode"></p></dd>
                                    <dd><p id="dduAdditional"></p></dd>
                                    <dt>Regulator:</dt><dd><p id="dduRegulator"></p></dd>
                                </dl>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <h5>System Administrator</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="dduSystemAdminName"></p></dd>
                                    <dt>Email:</dt><dd><p id="dduSystemAdminEmail"></p></dd>
                                    <dt>Telephone:</dt><dd><p id="dduSystemAdminTel"></p></dd>
                                </dl>
                                <h5>Other Details</h5>
                                <dl class="dl-horizontal">
                                    <dt>Created On:</dt><dd><p id="dduCompanyCreatedOn"></p></dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="s2" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <div class="well">
                                <div id="verifiedGrid"></div>
                            </div>
                        </div>
                    </div>

                    <div class="row hidden" id="verifiedPanel">
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <a id="resendButton" class="btn btn-primary btn-sm" data-modallink="true">Resend Login Details</a>
                                <a id="vEmailLogButton" class="btn btn-primary btn-sm" data-modallink="true">View Email Log</a>
                                <h5>Company</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="ddvCompanyName"></p></dd>
                                    <dt>Address:</dt>
                                    <dd><p id="ddvCompanyAddress1"></p></dd>
                                    <dd><p id="ddvCompanyAddress2"></p></dd>
                                    <dd><p id="ddvCompanyTownCity"></p></dd>
                                    <dd><p id="ddvCompanyCounty"></p></dd>
                                    <dd><p id="ddvCompanyPostCode"></p></dd>
                                    <dd><p id="ddvAdditional"></p></dd>
                                    <dt>Regulator:</dt><dd><p id="ddvRegulator"></p></dd>
                                </dl>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <h5>System Administrator</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="ddvSystemAdminName"></p></dd>
                                    <dt>Email:</dt><dd><p id="ddvSystemAdminEmail"></p></dd>
                                    <dt>Telephone:</dt><dd><p id="ddvSystemAdminTel"></p></dd>
                                </dl>
                                <h5>Other Details</h5>
                                <dl class="dl-horizontal">
                                    <dt>Created On:</dt><dd><p id="ddvCompanyCreatedOn"></p></dd>
                                    <dt>PIN Number:</dt><dd><p id="ddvPINNumber"></p></dd>
                                    <dt>PIN Created On:</dt><dd><p id="ddvPINCreatedOn"></p></dd>
                                    <dt>Login Details Sent:</dt><dd><p id="ddvLoginsSent"></p></dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="s3" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <div class="well">
                                <div id="rejectedGrid"></div>
                            </div>
                        </div>
                    </div>

                    <div class="row hidden" id="rejectedPanel">
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <h5>Company</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="ddrCompanyName"></p></dd>
                                    <dt>Address:</dt>
                                    <dd><p id="ddrCompanyAddress1"></p></dd>
                                    <dd><p id="ddrCompanyAddress2"></p></dd>
                                    <dd><p id="ddrCompanyTownCity"></p></dd>
                                    <dd><p id="ddrCompanyCounty"></p></dd>
                                    <dd><p id="ddrCompanyPostCode"></p></dd>
                                    <dd><p id="ddrAdditional"></p></dd>
                                    <dt>Regulator:</dt><dd><p id="ddrRegulator"></p></dd>
                                </dl>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <!-- well -->
                            <div class="well">
                                <h5>System Administrator</h5>
                                <dl class="dl-horizontal">
                                    <dt>Name:</dt><dd><p id="ddrSystemAdminName"></p></dd>
                                    <dt>Email:</dt><dd><p id="ddrSystemAdminEmail"></p></dd>
                                    <dt>Telephone:</dt><dd><p id="ddrSystemAdminTel"></p></dd>
                                </dl>
                                <h5>Other Details</h5>
                                <dl class="dl-horizontal">
                                    <dt>Rejected On:</dt><dd><p id="ddrRejectedOn"></p></dd>
                                    <dt>Rejected By:</dt><dd><p id="ddrRejectedBy"></p></dd>
                                    <dt>Rejected Reason:</dt><dd><p id="ddrRejectedReason"></p></dd>
                                    <dt>Rejected Notes:</dt><dd><p id="ddrRejectedNotes"></p></dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section pagespecific {
    <script type="text/javascript">

    //set up grid options for the three grids. most are passed straight on to kendo grid.
    var uGrid = new gridItem(
        {
            gridElementId: 'unverifiedGrid',
            url: '@Url.Action("LoadCompanies", "Company", new {area = "Admin", orgStatus = Bec.TargetFramework.Entities.Enums.ProfessionalOrganisationStatusEnum.Unverified})',
            schema: { data: "list", total: "total", model: { id: "OrganisationID" } },
            defaultSort: { field: "CreatedOn", dir: "asc" },
            change: unverifiedChange,
            jumpToId: '@TempData["AddTempCompanyId"]',
            panels: ['unverifiedPanel'],
            columns: [
                    {
                        field: "OrganisationID",
                        hidden: true,
                    },
                    {
                        field: "Name",
                        title: "Company Name"
                    },
                    {
                        field: "Line1",
                        title: "Address 1"
                    },
                    {
                        field: "PostalCode",
                        title: "Post Code"
                    },
                    {
                        field: "OrganisationAdminLastName",
                        title: "System Administrator",
                        template: function (dataItem) {
                            return kendo.htmlEncode(dataItem.OrganisationAdminFirstName) + " " + kendo.htmlEncode(dataItem.OrganisationAdminLastName);
                        }
                    },
                    {
                        field: "OrganisationAdminTelephone",
                        title: "Telephone Number"
                    },
                    {
                        field: "OrganisationAdminEmail",
                        title: "Email"
                    },
                    {
                        field: "CreatedOn",
                        title: "Created On",
                        template: function (dataItem) {
                            return dateString(dataItem.CreatedOn);
                        }
                    },
                    {
                        field: "CreatedBy",
                        title: "Created By"
                    }
            ]
        });

    var vGrid = new gridItem(
        {
            gridElementId: 'verifiedGrid',
            url: '@Url.Action("LoadCompanies", "Company", new { area = "Admin", orgStatus = Bec.TargetFramework.Entities.Enums.ProfessionalOrganisationStatusEnum.Verified })',
            schema: { data: "list", total: "total", model: { id: "OrganisationID" } },
            defaultSort: { field: "PinCreated", dir: "desc" },
            change: verifiedChange,
            jumpToId: '@TempData["VerifiedCompanyId"]',
            panels: ['verifiedPanel'],
            columns: [
                {
                    field: "OrganisationID",
                    hidden: true,
                },
                {
                    field: "Name",
                    title: "Company Name"
                },
                {
                    field: "PinCode",
                    title: "PIN Number"
                },
                {
                    field: "PinCreated",
                    title: "PIN Created",
                    template: function (dataItem) {
                        return dateString(dataItem.PinCreated);
                    }
                },
                {
                    field: "PostalCode",
                    title: "Post Code"
                },
                {
                    field: "OrganisationAdminLastName",
                    title: "System Administrator",
                    template: function (dataItem) {
                        return kendo.htmlEncode(dataItem.OrganisationAdminFirstName) + " " + kendo.htmlEncode(dataItem.OrganisationAdminLastName);
                    }
                },
                {
                    field: "OrganisationAdminTelephone",
                    title: "Telephone Number"
                },
                {
                    field: "OrganisationAdminEmail",
                    title: "Email"
                },
                {
                    field: "CreatedOn",
                    title: "Created On",
                    template: function (dataItem) {
                        return dateString(dataItem.CreatedOn);
                    }
                },
                {
                    field: "CreatedBy",
                    title: "Created By"
                }
            ]
        });

    var rGrid = new gridItem(
        {
            gridElementId: 'rejectedGrid',
            url: '@Url.Action("LoadCompanies", "Company", new { area = "Admin", orgStatus = Bec.TargetFramework.Entities.Enums.ProfessionalOrganisationStatusEnum.Rejected })',
            schema: { data: "list", total: "total", model: { id: "OrganisationID" } },
            defaultSort: { field: "StatusChangedOn", dir: "desc" },
            change: rejectedChange,
            panels: ['rejectedPanel'],
            columns: [
                {
                    field: "OrganisationID",
                    hidden: true,
                },
                {
                    field: "Name",
                    title: "Company Name"
                },
                {
                    field: "Line1",
                    title: "Address 1"
                },
                {
                    field: "PostalCode",
                    title: "Post Code"
                },
                {
                    field: "OrganisationAdminLastName",
                    title: "System Administrator",
                    template: function (dataItem) {
                        return kendo.htmlEncode(dataItem.OrganisationAdminFirstName) + " " + kendo.htmlEncode(dataItem.OrganisationAdminLastName);
                    }
                },
                {
                    field: "StatusChangedOn",
                    title: "Rejected On",
                    template: function (dataItem) {
                        return dateString(dataItem.StatusChangedOn);
                    }
                },
                {
                    field: "StatusChangedBy",
                    title: "Rejected By"
                },
                {
                    field: "Reason",
                    title: "Rejected Reason"
                }
            ]
        });

    //declare which grids are on which tabs, as the kendo grid can only be created once its container is shown.
    var tabs = new tabItem("myTab1",
        {
            s1: {
                grids: [uGrid]
            },
            s2: {
                grids: [vGrid]
            },
            s3: {
                grids: [rGrid]
            },
        });

    $(document).ready(function () {
        //set up tabs
        tabs.makeTab();
        tabs.showTab(@TempData["tabIndex"]);

        findModalLinks();
    });

    //data binding for the panes beneath each grid
    function unverifiedChange(dataItem) {
        $("p#dduCompanyName").text(dataItem.Name || "");
        $("p#dduCompanyCreatedOn").text(dateString(dataItem.CreatedOn));
        $("p#dduCompanyCounty").text(dataItem.County || "");
        $("p#dduCompanyPostCode").text(dataItem.PostalCode || "");
        $("p#dduCompanyTownCity").text(dataItem.Town || "");
        $("p#dduCompanyAddress2").text(dataItem.Line2 || "");
        $("p#dduCompanyAddress1").text(dataItem.Line1 || "");
        $("p#dduAdditional").text(dataItem.AdditionalAddressInformation || "");
        $("p#dduSystemAdminEmail").text(dataItem.OrganisationAdminEmail || "");
        $("p#dduSystemAdminTel").text(dataItem.OrganisationAdminTelephone || "");
        $("p#dduSystemAdminName").text(dataItem.OrganisationAdminSalutation + " " + dataItem.OrganisationAdminFirstName + " " + dataItem.OrganisationAdminLastName);

        var regulatorName = dataItem.Regulator || "";
        if (regulatorName.toLowerCase() == 'other') regulatorName = dataItem.RegulatorOther;
        $("p#dduRegulator").text(regulatorName);

        //update links
        $("#rejectButton").data('href', '@Url.Action("ViewRejectTempCompany", "Company", new { area = "Admin" })' + "?orgId=" + dataItem.OrganisationID);
        $("#pinButton").data('href', '@Url.Action("ViewGeneratePin", "Company", new { area = "Admin" })' + "?orgId=" + dataItem.OrganisationID + "&uaoId=" + dataItem.UserAccountOrganisationID);
        $("#uEmailLogButton").data('href', '@Url.Action("ViewEmailLog", "Company", new { area = "Admin" })' + "?orgId=" + dataItem.OrganisationID);
    }

    function verifiedChange(dataItem) {
        $("p#ddvCompanyName").text(dataItem.Name || "");
        $("p#ddvCompanyCreatedOn").text(dateString(dataItem.CreatedOn));
        $("p#ddvCompanyCounty").text(dataItem.County || "");
        $("p#ddvCompanyPostCode").text(dataItem.PostalCode || "");
        $("p#ddvCompanyTownCity").text(dataItem.Town || "");
        $("p#ddvCompanyAddress2").text(dataItem.Line2 || "");
        $("p#ddvCompanyAddress1").text(dataItem.Line1 || "");
        $("p#ddvAdditional").text(dataItem.AdditionalAddressInformation || "");
        $("p#ddvSystemAdminEmail").text(dataItem.OrganisationAdminEmail || "");
        $("p#ddvSystemAdminTel").text(dataItem.OrganisationAdminTelephone || "");
        $("p#ddvSystemAdminName").text(dataItem.OrganisationAdminSalutation + " " + dataItem.OrganisationAdminFirstName + " " + dataItem.OrganisationAdminLastName);

        var regulatorName = dataItem.Regulator || "";
        if (regulatorName.toLowerCase() == 'other') regulatorName = dataItem.RegulatorOther;
        $("p#ddvRegulator").text(regulatorName);

        $("p#ddvPINNumber").text(dataItem.PinCode);
        $("p#ddvPINCreatedOn").text(dateString(dataItem.PinCreated));
        $("p#ddvLoginsSent").text(dateString(dataItem.OrganisationAdminCreated));

        //update links
        $("#resendButton").data('href', '@Url.Action("ViewResendLogins", "Company", new { area = "Admin" })' + "?uaoId=" + dataItem.UserAccountOrganisationID + "&label=" + dataItem.Name);
        $("#vEmailLogButton").data('href', '@Url.Action("ViewEmailLog", "Company", new { area = "Admin" })' + "?orgId=" + dataItem.OrganisationID);
    }

    function rejectedChange(dataItem) {
        $("p#ddrCompanyName").text(dataItem.Name || "");
        $("p#ddrCompanyCounty").text(dataItem.County || "");
        $("p#ddrCompanyPostCode").text(dataItem.PostalCode || "");
        $("p#ddrCompanyTownCity").text(dataItem.Town || "");
        $("p#ddrCompanyAddress2").text(dataItem.Line2 || "");
        $("p#ddrCompanyAddress1").text(dataItem.Line1 || "");
        $("p#ddrAdditional").text(dataItem.AdditionalAddressInformation || "");
        $("p#ddrSystemAdminEmail").text(dataItem.OrganisationAdminEmail || "");
        $("p#ddrSystemAdminTel").text(dataItem.OrganisationAdminTelephone || "");
        $("p#ddrSystemAdminName").text(dataItem.OrganisationAdminSalutation + " " + dataItem.OrganisationAdminFirstName + " " + dataItem.OrganisationAdminLastName);

        var regulatorName = dataItem.Regulator || "";
        if (regulatorName.toLowerCase() == 'other') regulatorName = dataItem.RegulatorOther;
        $("p#ddrRegulator").text(regulatorName);

        $("p#ddrRejectedOn").text(dateString(dataItem.StatusChangedOn));
        $("p#ddrRejectedBy").text(dataItem.StatusChangedBy);
        $("p#ddrRejectedReason").text(dataItem.Reason);
        $("p#ddrRejectedNotes").text(dataItem.Notes);
    }

</script>
}
