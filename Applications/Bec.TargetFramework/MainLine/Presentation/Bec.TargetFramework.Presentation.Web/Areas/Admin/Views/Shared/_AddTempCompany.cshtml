@using Bec.TargetFramework.Entities
@model AddCompanyDTO
@{
    List<SelectListItem> regulators = new List<SelectListItem>
    {
        new SelectListItem{Text = "SRA", Value="SRA"},
        new SelectListItem{Text = "CLC", Value="CLC"},
        new SelectListItem{Text = "Other", Value="Other"}
    };

    List<SelectListItem> titles = new List<SelectListItem>
    {
        new SelectListItem{Text = "Mr", Value="Mr"},
        new SelectListItem{Text = "Mrs", Value="Mrs"},
        new SelectListItem{Text = "Miss", Value="Miss"},
        new SelectListItem{Text = "Ms", Value="Ms"},
        new SelectListItem{Text = "Dr", Value="Dr"}
    };
}

<div class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="addCompanyLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        
        <div class="help help-container help-lg">
            <div class="help-vert">HELP</div>
            <div class="help help-inner">
                <div>Help goes here</div>
            </div>
        </div>

        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title" id="addCompanyLabel">Add Company</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">

                        <form action="@Url.Action("AddTempCompany", "Company", new { area = "Admin" })" method="POST" id="addTempCompany-form" class="smart-form">
                            @Html.ValidationBootstrap()
                            @Html.AntiForgeryToken()
                            <fieldset>
                                <div class="row">
                                    <section class="col col-4">
                                        <label class="label">Lookup Postcode</label>
                                        <label class="input">
                                            <input id="postcodelookup" type="text" tabindex="1" maxlength="10" />
                                        </label>
                                    </section>

                                    <section class="col">
                                        <label class="label">&nbsp;</label>
                                        <button id="findaddressbutton" data-url="@Url.Action("FindAddress", "Home", new { Area = "" })" type="button" class="btn btn-default btn-sm" tabindex="2">Find Address</button>
                                    </section>
                                </div>

                                <section>
                                    <label class="select">
                                        <select id="addressresults" tabindex="3"></select>
                                        <i></i>
                                    </label>
                                </section>


                                <div class="row">
                                    <section class="col" id="noMatch">
                                        <em style="color:#d56161">No matches found, please enter address below</em>
                                    </section>
                                </div>

                                <div class="row" id="manAddRow">
                                    <section class="col">
                                        @Html.CheckBoxFor(m => m.Manual, new { id = "manualAddress" })
                                        <label for="manualAddress" tabindex="4">Edit Address Details</label>
                                    </section>
                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="label">Company Name</label>
                                        <label class="input ">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.CompanyName, new { tabindex = "5", maxlength = 50 })
                                        </label>
                                    </section>

                                    <section class="col col-6">
                                        <label class="label">Additional Address Information</label>
                                        <label class="input">
                                            @Html.TextBoxFor(m => m.AdditionalAddressInformation, new { @readonly = "readonly", tabindex = "11", maxlength = 50 })
                                        </label>
                                    </section>

                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="label">Company Address</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.Line1, new { @readonly = "readonly", placeholder = "Address Line 1", tabindex = "6", maxlength = 50 })
                                        </label>
                                    </section>

                                    <section class="col col-3">
                                        <label class="label">Regulator</label>
                                        <label class="select">
                                            @Html.DropDownListFor(m => m.Regulator, new SelectList(regulators, "Value", "Text"), "Please Select", new { tabindex = "12" })
                                            <i></i>
                                        </label>
                                    </section>

                                    <section class="col col-3" id="otherRegulatorSection">
                                        <label class="label">Other Regulator</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.RegulatorOther, new { placeholder = "Enter Regulator", maxlength = 50 })

                                        </label>
                                    </section>

                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="input">
                                            @Html.TextBoxFor(m => m.Line2, new { @readonly = "readonly", placeholder = "Address Line 2", tabindex = "7", maxlength = 50 })
                                        </label>
                                    </section>

                                    <section class="col col-6">
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.RegulatorNumber, new { placeholder = "Regulator Number", maxlength = 50 })
                                        </label>
                                    </section>
                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.Town, new { @readonly = "readonly", placeholder = "Town/City", tabindex = "8", maxlength = 50 })
                                        </label>
                                    </section>
                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="input">
                                            @Html.TextBoxFor(m => m.County, new { @readonly = "readonly", placeholder = "County", tabindex = "9", maxlength = 50 })
                                        </label>
                                    </section>
                                </div>

                                <div class="row">
                                    <section class="col col-6">
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.PostalCode, new { @readonly = "readonly", placeholder = "Post Code", tabindex = "10", maxlength = 10 })
                                        </label>
                                    </section>
                                </div>

                            </fieldset>
                            <fieldset>
                                <div class="row">
                                    <section class="col">
                                        <label class="label">System Admin Details</label>
                                    </section>
                                </div>
                                <div class="row">
                                    <section class="col col-2">
                                        <label class="label">Title</label>
                                        <label class="select">
                                            @Html.DropDownListFor(m => m.OrganisationAdminSalutation, new SelectList(titles, "Value", "Text"), "Please Select", new { tabindex = "13" })
                                            <i></i>
                                        </label>
                                    </section>
                                    <section class="col col-5">
                                        <label class="label">First Name</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.OrganisationAdminFirstName, new { tabindex = "14", maxlength = 50 })
                                        </label>
                                    </section>
                                    <section class="col col-5">
                                        <label class="label">Last Name</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.OrganisationAdminLastName, new { tabindex = "15", maxlength = 50 })
                                        </label>
                                    </section>

                                </div>
                                <div class="row">
                                    <section class="col col-8">
                                        <label class="label">Email</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.OrganisationAdminEmail, new { tabindex = "16", maxlength = 100 })
                                        </label>
                                    </section>
                                    <section class="col col-4">
                                        <label class="label">Telephone Number</label>
                                        <label class="input">
                                            <i class="icon-append fa fa-asterisk" style="font-size:0.7em;"></i>
                                            @Html.TextBoxFor(m => m.OrganisationAdminTelephone, new { tabindex = "17", maxlength = 20 })
                                        </label>
                                    </section>
                                </div>
                            </fieldset>

                        </form>

                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" id="cancelAdd" class="btn btn-default" data-dismiss="modal">
                    Cancel
                </button>
                <button type="button" id="formSubmit" class="btn btn-primary" tabindex="18">
                    Save
                </button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    new findAddress({
        postcodelookup: '#postcodelookup',
        companyName: '#CompanyName',
        line1: '#Line1',
        line2: '#Line2',
        town: '#Town',
        county: '#County',
        postcode: '#PostalCode',
        additionalAddress: '#AdditionalAddressInformation',
        manualAddress: '#manualAddress',
        resList: '#addressresults',
        manAddRow: '#manAddRow',
        noMatch: '#noMatch',
        findAddressButton: '#findaddressbutton'
    }).setup();

    // submit from when Save button clicked
    $("#formSubmit").click(function () {
        $("#addTempCompany-form").submit();
    });

    // Validation
    $("#addTempCompany-form").validate({
        ignore: '.skip',
        // Rules for form validation
        rules: {
            CompanyName: {
                required: true
            },
            Line1: {
                required: true
            },
            Town: {
                required: true
            },
            PostalCode: {
                required: true,
                minlength: 5
            },
            Regulator: {
                required: true
            },
            RegulatorOther: {
                required: {
                    depends: function (element) {
                        return $("#RegulatorOther").is(":visible")
                    }
                }
            },
            RegulatorNumber: {
                required: true
            },
            OrganisationAdminSalutation: {
                required: true
            },
            OrganisationAdminFirstName: {
                required: true
            },
            OrganisationAdminLastName: {
                required: true
            },
            OrganisationAdminEmail: {
                required: true,
                email: true,
                remote: {
                    url: '@Url.Action("CheckEmail", "Home", new { Area = "" })',
                    data: { email: function () { return $('#OrganisationAdminEmail').val(); } },
                    dataType: 'json',
                    error: function (xhr, status, error) { checkRedirect(xhr.responseJSON); }
                }
            },
            OrganisationAdminTelephone: {
                required: true
            }
        },

        // Do not change code below
        errorPlacement: function (error, element) {
            error.insertAfter(element.parent());
        },

        submitHandler: validateSubmit
    });

    function validateSubmit(form) {
        $("#formSubmit").prop('disabled', true);

        //handlemodal won't show the modal if there are no results, i.e. it receives a json result {"result" : "ok"}
        handleModal(
        {
            url: 'ViewDuplicates',
            data: {
                CompanyName: $('#CompanyName').val(),
                Postalcode: $('#PostalCode').val()
            }
        },
        {
            abortSave: function () {
                $("#formSubmit").prop('disabled', false);
            },
            save: function () {
                form.submit();
            }
        },
        true,
        "save"); //default action if no duplicate results
    }

    $("#otherRegulatorSection").hide();
    $("#Regulator").change(function () {
        var selectedValue = this.value;

        if (selectedValue.toLowerCase() == 'other') {
            $("#otherRegulatorSection").show();

        } else {
            $("#otherRegulatorSection").next('em[for="RegulatorOther"]').remove();
            $("#otherRegulatorSection").removeClass("state-error");
            $("#otherRegulatorSection").hide();
            $("#RegulatorOther").val(null);
        }
    });
</script>
