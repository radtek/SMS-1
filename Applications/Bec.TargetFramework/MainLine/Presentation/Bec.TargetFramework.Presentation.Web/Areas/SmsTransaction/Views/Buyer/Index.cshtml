<!-- MAIN CONTENT -->
<div id="content">
    <div class="row">

        <h2 class="row-seperator-header inline-heading">View Transactions</h2>
        <button class="inline-heading btn btn-default btn-sm pull-right" id="gridSearchButton">Search</button>
        <input class="inline-heading pull-right" type="text" id="gridSearchInput" />

        <div class="col-sm-12">

            <div class="row">
                <div class="col-sm-12">
                    <div class="well">
                        <div id="txGrid"></div>
                    </div>
                </div>
            </div>

            <div class="row hidden" id="rPanel">
                <div class="col-sm-6">
                    <!-- well -->
                    <div class="well">
                        <a id="editButton" class="btn btn-primary btn-sm" data-modallink="true">Edit Transaction</a>
                        <a id="resendButton" class="btn btn-primary btn-sm" data-modallink="true">Resend Login Details</a>
                        <h5>Selected Transaction</h5>
                        <dl class="dl-horizontal">
                            <dt>Name:</dt>
                            <dd><p id="ddName"></p></dd>
                            <dt>Email:</dt>
                            <dd><p id="ddEmail"></p></dd>
                            <dt>CreatednOn:</dt>
                            <dd><p id="ddCreated"></p></dd>
                        </dl>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">

    //set up grid options for the three grids. most are passed straight on to kendo grid.
    var txGrid = new gridItem(
        {
            gridElementId: 'txGrid',
            url: '@Url.Action("GetSmsTransactions", "Buyer", new { area = "SmsTransaction" })',
            schema: { data: "Items", total: "Count", model: { id: "SmsTransactionID" } },
            type: 'odata-v4',
            serverSorting: true,
            serverPaging: true,
            defaultSort: { field: "SmsTransactionID", dir: "asc" },
            panels: ['rPanel'],
            jumpToId: '@TempData["SmsTransactionID"]',
            change: txChange,
            searchElementId: 'gridSearchInput',
            searchButtonId: 'gridSearchButton',
            columns: [
                    {
                        field: "SmsTransactionID",
                        hidden: true,
                    },
                    {
                        field: "UserAccountOrganisation.Contact.LastName",
                        title: "Name",
                        template: function (dataItem) {
                            return dataItem.UserAccountOrganisation.Contact.FirstName + " " + dataItem.UserAccountOrganisation.Contact.LastName;
                        }
                    },
                    {
                        field: "UserAccountOrganisation.UserAccount.Email",
                        title: "Email"
                    },
                    {
                        field: "CreatedOn",
                        title: "Created",
                        template: function (dataItem) { return dateString(dataItem.CreatedOn); }
                    }
            ]
        });

    $(document).ready(function () {
        txGrid.makeGrid();

        findModalLinks();
    });

    //data binding for the panes beneath each grid
    function txChange(dataItem) {
        $("p#ddName").text(dataItem.UserAccountOrganisation.Contact.FirstName + " " + dataItem.UserAccountOrganisation.Contact.LastName);
        $("p#ddEmail").text(dataItem.UserAccountOrganisation.UserAccount.Email || "");
        $("p#ddCreated").text(dateString(dataItem.CreatedOn));

        $("#editButton").data('href', '@Url.Action("ViewEditSmsTransaction", "Buyer", new { area = "SmsTransaction" })' + "?txId=" + dataItem.SmsTransactionID);
        $("#resendButton").data('href', '@Url.Action("ViewResendLogins", "Buyer", new { area = "SmsTransaction" })' + "?txId=" + dataItem.SmsTransactionID + "&label=" + encodeURIComponent(dataItem.UserAccountOrganisation.Contact.FirstName + " " + dataItem.UserAccountOrganisation.Contact.LastName));

        $("#editButton").attr("disabled", !dataItem.UserAccountOrganisation.UserAccount.IsTemporaryAccount);
        $("#resendButton").attr("disabled", !dataItem.UserAccountOrganisation.UserAccount.IsTemporaryAccount);
        
    }

    </script>
}
