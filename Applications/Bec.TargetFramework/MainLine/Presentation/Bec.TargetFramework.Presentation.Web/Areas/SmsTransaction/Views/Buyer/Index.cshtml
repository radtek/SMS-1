@using Bec.TargetFramework.Entities
@{
    int i = 0;
    string aclass = "";
    string ain = "in";
}
@model IEnumerable<SmsUserAccountOrganisationTransactionDTO>
<!-- MAIN CONTENT -->
<div id="content">
    <div class="row">
        <div class="col-xs-12">
            <h1 class="page-title txt-color-blueDark">
                <i class="fa fa-desktop fa-fw "></i> Safe Buyer
            </h1>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-6">
            <div class="jarviswidget well transparent" role="widget">
                <div role="content">
                    <div>
                        <div class="panel-group smart-accordion-default" id="accordion">
                            @foreach (var tx in Model)
                            {
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse-@i" class="@aclass">
                                                <i class="fa fa-lg fa-angle-down"></i> <i class="fa fa-lg fa-angle-up"></i>
                                                <strong>@tx.SmsTransaction.Organisation.OrganisationDetails.First().Name</strong> Safe Buyer
                                                @if (!string.IsNullOrEmpty(tx.SmsTransaction.Address.Line1))
                                                {
                                                    <span>
                                                        - Purchase of @tx.SmsTransaction.Address.Line1 @tx.SmsTransaction.Address.PostalCode
                                                    </span>
                                                }
                                            </a>
                                        </h4>
                                    </div>
                                    <div id="collapse-@i" class="panel-collapse collapse @ain">
                                        <div class="panel-body no-padding">
                                            <form id="check-Form-@i" data-index="@i" data-url="@Url.Action("performcheck", "Check" , new { area="BankAccount" , orgid=tx.SmsTransaction.OrganisationID })" class="smart-form bank-check-form">
                                                @Html.ValidationBootstrap()
                                                @Html.AntiForgeryToken()
                                                <div class="alert alert-info fade in margin-left-10 margin-right-10 margin-top-10">
                                                    <h5 class="margin-top-10 margin-bottom-10"><i class="fa-fw fa fa-info"></i><strong>How to use?</strong></h5>
                                                    <p>
                                                        This part of the Safe Move Scheme confirms whether the bank account details you have been given, to pay money to your conveyancing firm, actually belong to that firm.
                                                    </p>
                                                    <p>
                                                        Please enter the Account Number and Sort Code of the bank account you have received from the above firm.
                                                    </p>
                                                    <p>
                                                        This system will check whether these bank account details match those validated by the Safe Move Scheme. Please note this system will not perform a transfer of funds.
                                                    </p>
                                                </div>
                                                <fieldset>
                                                    <div class="row">
                                                        <section class="col col-sm-12">
                                                            <label class="input">
                                                                <i class="icon-append fa fa-asterisk" style="font-size: 0.7em;"></i>
                                                                <input type="text" name="accountNumber" id="accountNumber" placeholder="Account Number" maxlength="8" />
                                                            </label>
                                                        </section>
                                                    </div>

                                                    <div class="row">
                                                        <section class="col col-sm-12">
                                                            <label class="input">
                                                                <i class="icon-append fa fa-asterisk" style="font-size: 0.7em;"></i>
                                                                <input type="text" name="sortCode" id="sortCode" placeholder="Sort Code" maxlength="6" />
                                                            </label>
                                                        </section>
                                                    </div>
                                                </fieldset>
                                                <footer>
                                                    <button type="submit" class="check-button btn btn-primary">
                                                        Check<i class="fa fa-spin fa-spinner margin-left-5" id="spinner-@i" style="display:none;"></i>
                                                    </button>
                                                </footer>
                                            </form>
                                            <div class="alert alert-success" style="display: none;" id="result-match-@i">
                                                <h4 class="alert-heading"><i class="fa fa-check-square-o"></i> Match</h4>
                                            </div>
                                            <div class="alert alert-danger" style="display: none;" id="result-no-match-@i">
                                                <h4 class="alert-heading"><i class="fa fa-warning"></i> No Match. Do not send funds.</h4>
                                                <p>The details given do not match your conveyancer's bank account.</p>
                                                <p>If you have made a mistake, please correct the details and check again.</p>
                                                <p>Otherwise, please contact @tx.SmsTransaction.Organisation.OrganisationDetails.First().Name immediately.</p>
                                            </div>
                                            <div class="alert alert-danger" style="display: none;" id="result-server-error-@i">
                                                <h4 class="alert-heading"><i class="fa fa-warning"></i> Server Error occurred. Please try again later.</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                i++;
                                aclass = "collapsed";
                                ain = "";
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script async src="@Scripts.Url("~/Scripts/SmsTransaction/Buyer/Index")"></script>
}
