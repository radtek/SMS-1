@using Bec.TargetFramework.Entities.Enums
@using Bec.TargetFramework.Infrastructure.Extensions
@using Bec.TargetFramework.Presentation.Web.Models

<div class="panel-group smart-accordion-default" id="{{accordionId}}">
    {{#each items}}
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title" data-parent="#{{@@root.accordionId}}">
                <a data-toggle="collapse" href="#{{elementId}}" aria-expanded="false" class="collapsed">
                    <i class="fa fa-lg fa-angle-down pull-right"></i>
                    <i class="fa fa-lg fa-angle-up pull-right"></i>
                    <span>{{fullName}}</span>
                </a>
            </h4>
        </div>
        <div class="panel-collapse collapse" aria-expanded="false" id="{{elementId}}">
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-12">
                        <h5>Personal Details</h5>
                        {{#if UserAccountOrganisation.UserAccount.IsTemporaryAccount}}
                        <div class="pull-right">
                            <a class="btn btn-sm btn-primary" data-modallink="true" title="Regenerate PIN"
                               data-href="@Url.Action("ViewGeneratePIN", "Transaction", new { area = "SmsTransaction" })?txID={{transactionId}}&uaoID={{UserAccountOrganisation.UserAccountOrganisationID}}&email={{UserAccountOrganisation.UserAccount.Email}}&pageNumber={{@@root.pageNumber}}">
                                <i class="fa fa-repeat margin-right-5"></i>Regenerate PIN
                            </a>
                        </div>
                        {{/if}}

                        <table class="transaction-details-table"
                               data-magic-edit="true"
                               data-edit-url="@Url.Action("GetFieldUpdates", "App", new { area = "" })"
                               data-update-url="@Url.Action("PostImmediateUpdate", "App", new { area = "" })"
                               data-approve-url="@Url.Action("ApproveUpdate", "App", new { area = "" })"
                               data-reject-url="@Url.Action("RejectUpdate", "App", new { area = "" })"
                               data-activity-type="@ActivityType.SmsTransaction.GetIntValue()"
                               data-activity-id="{{SmsTransactionID}}">
                            <tr>
                                <td>Full Name</td>
                                <td><p>{{fullName}}</p></td>
                            </tr>
                            <tr>
                                <td>Email</td>
                                <td><p>{{UserAccountOrganisation.UserAccount.Email}}</p></td>
                            </tr>

                            {{#if formattedBirthDate}}
                            <tr>
                                <td>Date of Birth</td>
                                <td><p>{{formattedBirthDate}}</p></td>
                            </tr>
                            {{/if}}

                            {{#if UserAccountOrganisation.UserAccount.IsTemporaryAccount}}
                            <tr>
                                <td>PIN:</td>
                                <td><p>{{UserAccountOrganisation.PinCode}}</p></td>
                            </tr>
                            {{/if}}

                            {{#if formattedLastLogin}}
                            <tr>
                                <td>Last Logged In:</td>
                                <td><p>{{formattedLastLogin}}</p></td>
                            </tr>
                            {{/if}}
                            <tr>
                                <td>Registered Home Address</td>
                                <td>
                                    <div class="magic-edit">
                                        <div class="view">
                                            <p><span data-field="Line1" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" data-no-value-text="TBC">{{Address.Line1}}</span></p>
                                            <p><span data-field="Line2" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()">{{Address.Line2}}</span></p>
                                            <p><span data-field="Town" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()">{{Address.Town}}</span></p>
                                            <p><span data-field="County" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()">{{Address.County}}</span></p>
                                            <p><span data-field="PostalCode" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()">{{Address.PostalCode}}</span></p>
                                        </div>
                                        <div class="edit">
                                            <form class="smart-form">
                                                @Html.Partial("_PostcodeLookup", new PostcodeLookupModel { Prefix = "tx" })
                                                <label class="input">
                                                    <i class="icon-append fa fa-asterisk" style="font-size: 0.7em;"></i>
                                                    <input type="text" value="{{Address.Line1}}" data-rule-required="true" class="form-control" data-field="Line1" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" id="txLine1" name="txLine1" placeholder="Address Line 1" />
                                                </label>
                                                <label class="input">
                                                    <input type="text" value="{{Address.Line2}}" data-rule-required="true" class="form-control" data-field="Line2" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" id="txLine2" name="txLine2" placeholder="Address Line 2" />
                                                </label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-asterisk" style="font-size: 0.7em;"></i>
                                                    <input type="text" value="{{Address.Town}}" data-rule-required="true" class="form-control" data-field="Town" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" id="txTown" name="txTown" placeholder="Town" />
                                                </label>
                                                <label class="input">
                                                    <input type="text" value="{{Address.County}}" class="form-control" data-field="County" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" id="txCounty" name="txCounty" placeholder="County" />
                                                </label>
                                                <label class="input">
                                                    <i class="icon-append fa fa-asterisk" style="font-size: 0.7em;"></i>
                                                    <input type="text" value="{{Address.PostalCode}}" data-rule-required="true" data-rule-minlength="5" class="form-control" data-field="PostalCode" data-parent-id="{{SmsUserAccountOrganisationTransactionID}}" data-parent-type="@FieldUpdateParentType.RegisteredHomeAddress.GetIntValue()" id="txPostalCode" name="txPostalCode" placeholder="PostalCode" />
                                                </label>
                                            </form>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>

                    </div>
                </div>
                {{#if srcFundsBankAccounts.length}}
                <h5>Personal Bank Account(s)</h5>
                <div class="row">
                    <div class="col-lg-6">
                        <div class="table-responsive">
                            <table class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>Account Number</th>
                                        <th>Sort Code</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each srcFundsBankAccounts}}
                                    <tr>
                                        <td>{{AccountNumber}}</td>
                                        <td>{{SortCode}}</td>
                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
    {{/each}}
</div>