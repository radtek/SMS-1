@using Bec.TargetFramework.Web.Framework.Extensions
@using Ext.Net
@using Ext.Net.MVC
@model Bec.TargetFramework.Entities.vOrganisationDTO

@(
 Html.X()
 .FormPanel()
 .ID("OrganisationDetailEditForm")
 .ApplyFormPanelDefaults(Razor.ApplyFormPanelDefaults)
 .Padding(10)
            .Items
            (
            Html.X().Container().Padding(5).Items(
            Html.X().AntiForgeryField(),
                 Html.X().Container().Padding(2)

                            .Items(
                                    Html.X().MultiSelect().ID("DetailFormErrors").Hidden(true)),
                                    Html.X().HiddenFor(model => model.OrganisationID),
                    Html.X().Container().Layout(LayoutType.Form).Padding(5)
                    .Items
                    (
                        Html.X().TextFieldFor(model => model.Name)
                        .ApplyTextFieldDefaults(Razor.ApplyTextFieldDefaults)
                               .ReadOnly(true),
                        Html.X().TextAreaFor(model => model.Description)
                        .ApplyTextAreaDefaults(Razor.ApplyTextAreaDefaults).Rows(2)
                    ),
                        Html.X().TabPanel().MaxHeight(600).ColumnWidth(1).Layout(LayoutType.Form).Items(
                         Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(1).Title("Internal Roles/Groups").Items
                         (
                           Html.X().Container().Layout(LayoutType.Column)
                      .Items
                      (

                          Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Internal Roles: Drag")
                              .Items
                              (
                                         Html.X()
                                             .MultiSelect()
                                                         .ValueField("RoleTemplateID")
                                                         .DisplayField("RoleTemplateName")
                                             .DragGroup("role1")
                                             .DropGroup("role1")
                                             .MultiSelect(true)
                                                 .Flex(1)
                                                 .MinHeight(400)
                                                 .MaxHeight(400)
                                                 .AutoScroll(true)
                                             .ListTitle("All Roles")
                                             .Store(Html.X()
                                                        .Store()
                                                        .AutoLoad(true)
                                                        .RemoteSort(false)
                                                        .Model(Html.X()
                                                                   .Model()
                                                                   .Fields(fields =>
                                                                   {
                                                                       fields.Add(new ModelField("RoleTemplateName"));
                                                                       fields.Add(new ModelField("RoleTemplateID"));
                                                                   })
                                                                   .Proxy(proxy => proxy.Add(Html.X()
                                                                                                 .AjaxProxy()
                                                                                                         .Url(Url.Action("GetOrganisationRoles", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                                                                 .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                             ),
                                     Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected Internal Roles: Drop")
                              .Items(

                                         Html.X()
                                             .MultiSelect()
                                             .ListTitle("Selected Role Template")
                                             .ID("SelectedRoles")
                                             .Flex(1)
                                                 .MinHeight(400)
                                                     .MaxHeight(400)
                                             .AutoScroll(true)
                                             .MultiSelect(true)
                                             .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                             .DragGroup("role1")
                                             .DropGroup("role1")


                                                         .ValueField("RoleTemplateID")
                                                         .DisplayField("RoleTemplateName")
                                             .Store(Html.X()
                                                        .Store()
                                                        .AutoLoad(true)
                                                        .RemoteSort(false)

                                                        .Model(Html.X()
                                                                   .Model()
                                                                   .Fields(fields =>
                                                                   {
                                                                       fields.Add(new ModelField("RoleTemplateName"));
                                                                       fields.Add(new ModelField("RoleTemplateID"));
                                                                   }).Proxy(proxy => proxy.Add(Html.X()
                                                        .AjaxProxy()
                                                                .Url(Url.Action("GetOrganisationRolesforOrgId", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                        .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                   ))),


                                    Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Internal Groups: Drag")
                                  .Items
                                  (
                                             Html.X()
                                                 .MultiSelect()
                                                                 .ValueField("GroupTemplateID")
                                                                 .DisplayField("GroupTemplateName")
                                                     .DragGroup("grp1")
                                                     .DropGroup("grp1")
                                                 .MultiSelect(true)
                                                     .Flex(1)
                                                     .MinHeight(400)
                                                     .MaxHeight(400)
                                                     .AutoScroll(true)
                                                 .ListTitle("All Groups")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)
                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("GroupTemplateName"));
                                                                           fields.Add(new ModelField("GroupTemplateID"));
                                                                       })
                                                                       .Proxy(proxy => proxy.Add(Html.X()
                                                                                                     .AjaxProxy()
                                                                                                                     .Url(Url.Action("GetOrganisationGroups", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                                                                     .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                                 ),
                                             Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected Internal Groups: Drop")
                                  .Items(

                                             Html.X()
                                                 .MultiSelect()
                                                     .ListTitle("Selected Groups")
                                                 .ID("SelectedGroups")
                                                 .Flex(1)
                                                     .MinHeight(400)
                                                         .MaxHeight(400)
                                                 .AutoScroll(true)
                                                 .MultiSelect(true)
                                                 .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                                     .DragGroup("grp1")
                                                     .DropGroup("grp1")
                                                                 .ValueField("GroupTemplateID")
                                                                 .DisplayField("GroupTemplateName")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)
                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("GroupTemplateName"));
                                                                           fields.Add(new ModelField("GroupTemplateID"));
                                                                       }).Proxy(proxy => proxy.Add(Html.X()
                                                        .AjaxProxy()
                                                        .Url(Url.Action("GetOrganisationGroupsforOrgId", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                        .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                       )))

                             )),
                              Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(1).Title("External Roles/Groups").Items
                         (
                                 Html.X().Container().Layout(LayoutType.Column)
                          .Items
                          (

                                  Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("External Roles: Drag")
                                  .Items
                                  (
                                             Html.X()
                                                 .MultiSelect()
                                                                 .ValueField("ExternalRoleTemplateID")
                                                                 .DisplayField("ExternalRoleTemplateName")
                                                     .DragGroup("role2")
                                                     .DropGroup("role2")
                                                 .MultiSelect(true)
                                                     .Flex(1)
                                                     .MinHeight(400)
                                                     .MaxHeight(400)
                                                     .AutoScroll(true)
                                                 .ListTitle("External Roles")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)
                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("ExternalRoleTemplateName"));
                                                                           fields.Add(new ModelField("ExternalRoleTemplateID"));
                                                                       })
                                                                       .Proxy(proxy => proxy.Add(Html.X()
                                                                                                     .AjaxProxy()
                                                                                                     .Url(Url.Action("GetOrganisationExternalRoles", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                                                                     .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                                 ),
                                             Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected External Roles: Drop")
                                  .Items(

                                             Html.X()
                                                 .MultiSelect()
                                                 .ListTitle("Selected External Roles")
                                                     .ID("SelectedExternalRoles")
                                                 .Flex(1)
                                                     .MinHeight(400)
                                                         .MaxHeight(400)
                                                 .AutoScroll(true)
                                                 .MultiSelect(true)
                                                 .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                                     .DragGroup("role2")
                                                     .DropGroup("role2")


                                                                 .ValueField("ExternalRoleTemplateID")
                                                                 .DisplayField("ExternalRoleTemplateName")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)

                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("ExternalRoleTemplateName"));
                                                                           fields.Add(new ModelField("ExternalRoleTemplateID"));
                                                                       }).Proxy(proxy => proxy.Add(Html.X()
                                                    .AjaxProxy()
                                                    .Url(Url.Action("GetOrganisationExternalRolesforOrgId", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                    .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                       ))),


                                            Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("External Groups: Drag")
                                      .Items
                                      (
                                                 Html.X()
                                                     .MultiSelect()
                                                                         .ValueField("ExternalGroupTemplateID")
                                                                         .DisplayField("ExternalGroupTemplateName")
                                                             .DragGroup("grp2")
                                                             .DropGroup("grp2")
                                                     .MultiSelect(true)
                                                         .Flex(1)
                                                         .MinHeight(400)
                                                         .MaxHeight(400)
                                                         .AutoScroll(true)
                                                     .ListTitle("External Groups")
                                                     .Store(Html.X()
                                                                .Store()
                                                                .AutoLoad(true)
                                                                .RemoteSort(false)
                                                                .Model(Html.X()
                                                                           .Model()
                                                                           .Fields(fields =>
                                                                           {
                                                                               fields.Add(new ModelField("ExternalGroupTemplateName"));
                                                                               fields.Add(new ModelField("ExternalGroupTemplateID"));
                                                                           })
                                                                           .Proxy(proxy => proxy.Add(Html.X()
                                                                                                         .AjaxProxy()
                                                                                                         .Url(Url.Action("GetOrganisationExternalGroups", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                                                                         .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                                     ),
                                                     Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected External Groups: Drop")
                                      .Items(

                                                 Html.X()
                                                     .MultiSelect()
                                                             .ListTitle("Selected External Groups")
                                                         .ID("SelectedExternalGroups")
                                                     .Flex(1)
                                                         .MinHeight(400)
                                                             .MaxHeight(400)
                                                     .AutoScroll(true)
                                                     .MultiSelect(true)
                                                     .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                                             .DragGroup("grp2")
                                                             .DropGroup("grp2")
                                                                         .ValueField("ExternalGroupTemplateID")
                                                                         .DisplayField("ExternalGroupTemplateName")
                                                     .Store(Html.X()
                                                                .Store()
                                                                .AutoLoad(true)
                                                                .RemoteSort(false)
                                                                .Model(Html.X()
                                                                           .Model()
                                                                           .Fields(fields =>
                                                                           {
                                                                               fields.Add(new ModelField("ExternalGroupTemplateName"));
                                                                               fields.Add(new ModelField("ExternalGroupTemplateID"));
                                                                           }).Proxy(proxy => proxy.Add(Html.X()
                                                    .AjaxProxy()
                                                    .Url(Url.Action("GetOrganisationExternalGroupsforOrgId", "OrganisationEdit", new { id = Model.OrganisationID, area = "Component" }))
                                                    .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                           )))

                                 )))
                    
                    

))


        .TopBar(Html.X().Toolbar()
                    .Items(
                        Html.X().ToolbarFill(),
                            Html.X()
                                   .Button()
                                    .ApplyButtonDefaults(Razor.ApplySaveButtonDefaults)
                               .DirectEvents(de =>
                               {
                                   de.Click.Before = "return #{OrganisationDetailEditForm}.isValid();";
                                   de.Click.Url = Url.Action("Edit", "OrganisationEdit", new { area = "Component", containerId = "AdministrationCenterPanel" });
                                   de.Click.ExtraParams.Add(new Parameter("roles", "App.SelectedRoles.getValues()", ParameterMode.Raw));
                                   de.Click.ExtraParams.Add(new Parameter("groups", "App.SelectedGroups.getValues()", ParameterMode.Raw));
                                   de.Click.ExtraParams.Add(new Parameter("extroles", "App.SelectedExternalRoles.getValues()", ParameterMode.Raw));
                                   de.Click.ExtraParams.Add(new Parameter("extgroups", "App.SelectedExternalGroups.getValues()", ParameterMode.Raw));
                                   de.Click.FormID = "OrganisationDetailEditForm";
                               }),

                                   Html.X().Button().ApplyButtonDefaults(Razor.ApplyResetButtonDefaults).OnClientClick("App.OrganisationDetailEditForm.getForm().reset();"),
                                   Html.X().Button().ApplyButtonDefaults(Razor.ApplyCancelButtonDefaults)
                                       .DirectClickUrl(Url.Action("OrganisationManagement", "Organisation", new { area = "Component", containerId = "AdministrationCenterPanel" }))

    ))

)