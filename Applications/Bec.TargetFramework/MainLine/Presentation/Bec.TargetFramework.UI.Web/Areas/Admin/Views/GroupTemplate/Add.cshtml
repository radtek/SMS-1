@using Bec.TargetFramework.Web.Framework.Extensions
@model Bec.TargetFramework.Entities.GroupTemplateDTO

@(Html.X()
          .FormPanel()
          .ID("AddGroupTemplateForm")
          .Title("Add Group Template")
          .ApplyFormPanelDefaults(Razor.ApplyFormPanelDefaults)
          .Items(
              Html.X().AntiForgeryField(),
                   Html.X().Container().Layout(LayoutType.Column)
              .Items
              (
                  Html.X().Container().Layout(LayoutType.Form).ColumnWidth(0.5).Padding(5)
                      .Items
                      (
                          Html.X()
                              .TextFieldFor(model => model.GroupTemplateName)
                              .AllowBlank(false)
                              .ApplyTextFieldDefaults(Razor.ApplyTextFieldDefaults)
                                    .Control(c =>
                                        {
                                            c.IsRemoteValidation = true;
                                            c.RemoteValidation.Url = Url.Action("DoesGroupTemplateNameExist", "GroupTemplate", new { area = "Admin" });
                                            c.RemoteValidation.ValidationEvent = "change, blur";
                                            c.RemoteValidation.Method = Ext.Net.HttpMethod.POST;
                                            c.RemoteValidation.ShowBusy = false;
                                            c.RemoteValidation.ErrorMessage = "The group name already exists";
                                        }),
                          Html.X().TextAreaFor(model => model.GroupTemplateDescription)
                              .AllowBlank(false)
                              .ApplyTextAreaDefaults(Razor.ApplyTextAreaDefaults),
                          Html.X().ComboBoxFor(model => model.GroupTypeID)
                                    .AllowBlank(false)
                                      .ApplyComboxDefaults(Razor.ApplyComboBoxClassificationDefaults)
                                      .FieldLabel("Type")
                                          .Store(Razor.CreateClassificationStore("GroupTemplateType", Url.Action("ReadData", "Reference", new { area = "" })))
                       )),
                       
                        Html.X().Container().Layout(LayoutType.Column)
              .Items
              (
                  Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.5).Padding(5).Title("All Roles: Drag")
                      .Items
                      (
                                 Html.X()
                                     .MultiSelect()
                                         .ValueField("RoleValue")
                                         .DisplayField("RoleName")
                                     .DragGroup("grp1")
                                     .DropGroup("grp1")
                                     .MultiSelect(true)
                                         .Flex(1)
                                         .MinHeight(400)
                                         .MaxHeight(400)
                                         .AutoScroll(true)
                                     .ListTitle("All Claims")
                                     .Store(Html.X()
                                                .Store()
                                                .AutoLoad(true)
                                                .RemoteSort(false)
                                                .Model(Html.X()
                                                           .Model()
                                                           .Fields(fields =>
                                                           {
                                                               fields.Add(new ModelField("RoleName"));
                                                               fields.Add(new ModelField("RoleValue"));
                                                           })
                                                           .Proxy(proxy => proxy.Add(Html.X()
                                                                                         .AjaxProxy()
                                                                                         .Url(Url.Action("GetRoleItems", "GroupTemplate", new { id = Model.GroupTemplateID, area = "Admin" }))
                                                                                         .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))
                                                                                        
                                     
                                              
                     ),
                         Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.5).Padding(5).Title("Group Roles: Drop")
                      .Items(
                               
                                 Html.X()
                                     .MultiSelect()
                                     .ListTitle("Selected Roles")
                                     .ID("SelectedClaims")
                                     .Flex(1)
                                         .MinHeight(400)
                                             .MaxHeight(400)
                                     .AutoScroll(true)
                                     .MultiSelect(true)
                                     .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                     .DragGroup("grp1")
                                     .DropGroup("grp1")
                                     
                                     
                                         .ValueField("RoleValue")
                                         .DisplayField("RoleName")
                                     .Store(Html.X()
                                                .Store()
                                                .AutoLoad(true)
                                                .RemoteSort(false)
                                 // GetClaimSourceItemsForRoleId
    
                                                .Model(Html.X()
                                                           .Model()
                                                           .Fields(fields =>
                                                           {
                                                               fields.Add(new ModelField("RoleName"));
                                                               fields.Add(new ModelField("RoleValue"));
                                                           })
                                                           .Proxy(proxy => proxy.Add(Html.X()
                                                                                         .AjaxProxy()
                                                                                             .Url(Url.Action("GetRoleItemsForGroupTemplateId", "GroupTemplate", new { id = Model.GroupTemplateID, area = "Admin" }))
                                                                                            .Reader(reader => reader.Add(Html.X().JsonReader().Root("data"))))))))
                     )
                    )
          .TopBar(Html.X().Toolbar()
            .Items(
                Html.X().ToolbarFill(),
                    Html.X()
                           .Button()
                           .ApplyButtonDefaults(Razor.ApplySaveButtonDefaults)
                           .DirectEvents(de =>
                           {
                               de.Click.Before = "return #{AddGroupTemplateForm}.isValid();";
                               de.Click.Url = Url.Action("Add", "GroupTemplate", new { area = "Admin", containerId = "AdministrationCenterPanel" });
                               de.Click.FormID = "AddGroupTemplateForm";
                               de.Click.ExtraParams.Add(new Parameter("items", "App.SelectedClaims.getValues()", ParameterMode.Raw));
                           }),

                                   Html.X().Button().ApplyButtonDefaults(Razor.ApplyResetButtonDefaults).OnClientClick("App.AddGroupTemplateForm.getForm().reset();"),
                           Html.X().Button().ApplyButtonDefaults(Razor.ApplyCancelButtonDefaults)
                        .DirectEvents(de =>
                        {
                            de.Click.Url = Url.Action("GroupTemplateManagement", "GroupTemplate", new { area = "Admin", containerId = "AdministrationCenterPanel" });
                        })
            ))                  
      )