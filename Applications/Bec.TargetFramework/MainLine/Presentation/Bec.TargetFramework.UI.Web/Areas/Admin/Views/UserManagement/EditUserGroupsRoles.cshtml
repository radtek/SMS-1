@using Bec.TargetFramework.Web.Framework.Extensions
@using Ext.Net
@using Ext.Net.MVC
@model Bec.TargetFramework.Entities.ContactDTO

@(Html.X().FormPanel().ID("EditUserGroupForm")
 .ApplyFormPanelDefaults(Razor.ApplyFormPanelDefaults)
     .Items
            (
            Html.X().Container().Padding(5).Items(
            Html.X().AntiForgeryField(),
                 Html.X().Container().Padding(2)

                .Items(
                    Html.X().MultiSelect().ID("DetailFormErrors").Hidden(true)),
                    Html.X().HiddenFor(model => model.OrganisationID),
                    Html.X().Container().Layout(LayoutType.Form).Padding(5)
                .Items
                (
                    Html.X().DisplayFieldFor(model => model.ContactName).FieldLabel("User Name:").ID("userDisplayName")
                   
                ),

                      Html.X().Container().Layout(LayoutType.Column)
                      .Items
                      (
                        Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Roles: Drag")
                            .Items
                            (
                                             Html.X()
                                                 .MultiSelect()
                                                             .ValueField("OrganisationRoleID")
                                                             .DisplayField("Name")
                                                 .DragGroup("role1")
                                                 .DropGroup("role1")
                                                 .MultiSelect(true)
                                                     .Flex(1)
                                                     .MinHeight(400)
                                                     .MaxHeight(400)
                                                     .AutoScroll(true)
                                                 .ListTitle("All Roles")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)
                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("Name"));
                                                                           fields.Add(new ModelField("OrganisationRoleID"));
                                                                       })
                                                                       .Proxy(proxy => proxy.Add(Html.X()
                                                                                                     .AjaxProxy()
                                                                                                     .Url(Url.Action("GetOrganisationRoles", "UserManagement", new { area = "Admin", userId = Model.UserID, orgId = Model.OrganisationID }))
                                                                                                     .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                                 ),
                                         Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected Roles: Drop")
                                  .Items(

                                             Html.X()
                                                 .MultiSelect()
                                                 .ListTitle("Selected Role Template")
                                                 .ID("SelectedRoles")
                                                 .Flex(1)
                                                 .MinHeight(400)
                                                 .MaxHeight(400)
                                                 .AutoScroll(true)
                                                 .MultiSelect(true)
                                                 .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                                 .DragGroup("role1")
                                                 .DropGroup("role1")
                                                 .ValueField("OrganisationRoleID")
                                                 .DisplayField("Name")
                                                 .Store(Html.X()
                                                            .Store()
                                                            .AutoLoad(true)
                                                            .RemoteSort(false)

                                                            .Model(Html.X()
                                                                       .Model()
                                                                       .Fields(fields =>
                                                                       {
                                                                           fields.Add(new ModelField("Name"));
                                                                           fields.Add(new ModelField("OrganisationRoleID"));
                                                                       }).Proxy(proxy => proxy.Add(Html.X()
                                                            .AjaxProxy()
                                                                        .Url(Url.Action("GetUserRoles", "UserManagement", new { area = "Admin", userId = Model.UserID, orgId = Model.OrganisationID }))
                                                            .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                       ))),


                                        Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Groups: Drag")
                                      .Items
                                      (
                                                 Html.X()
                                                     .MultiSelect()
                                                     .ValueField("OrganisationGroupID")
                                                     .DisplayField("Name")
                                                     .DragGroup("grp1")
                                                     .DropGroup("grp1")
                                                     .MultiSelect(true)
                                                     .Flex(1)
                                                     .MinHeight(400)
                                                     .MaxHeight(400)
                                                     .AutoScroll(true)
                                                     .ListTitle("All Groups")
                                                     .Store(Html.X()
                                                                .Store()
                                                                .AutoLoad(true)
                                                                .RemoteSort(false)
                                                                .Model(Html.X()
                                                                           .Model()
                                                                           .Fields(fields =>
                                                                           {
                                                                               fields.Add(new ModelField("Name"));
                                                                               fields.Add(new ModelField("OrganisationGroupID"));
                                                                           })
                                                                           .Proxy(proxy => proxy.Add(Html.X()
                                                                                                         .AjaxProxy()
                                                                                                         .Url(Url.Action("GetOrganisationGroups", "UserManagement", new { area = "Admin", userId = Model.ParentID, orgId = Model.OrganisationID }))
                                                                                                         .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))))



                                     ),
                                                 Html.X().Panel().Layout(LayoutType.Form).ColumnWidth(0.25).Padding(5).Title("Selected Groups: Drop")
                                      .Items(

                                                 Html.X()
                                                     .MultiSelect()
                                                     .ListTitle("Selected Groups")
                                                     .ID("SelectedGroups")
                                                     .Flex(1)
                                                     .MinHeight(400)
                                                     .MaxHeight(400)
                                                     .AutoScroll(true)
                                                     .MultiSelect(true)
                                                     .CustomConfig(c => c.Add(new ConfigItem("submitText", "false", ParameterMode.Raw)))
                                                         .DragGroup("grp1")
                                                         .DropGroup("grp1")
                                                                     .ValueField("OrganisationGroupID")
                                                                     .DisplayField("Name")
                                                     .Store(Html.X()
                                                                .Store()
                                                                .AutoLoad(true)
                                                                .RemoteSort(false)
                                                                .Model(Html.X()
                                                                           .Model()
                                                                           .Fields(fields =>
                                                                           {
                                                                               fields.Add(new ModelField("Name"));
                                                                               fields.Add(new ModelField("OrganisationGroupID"));
                                                                           }).Proxy(proxy => proxy.Add(Html.X()
                                                            .AjaxProxy()
                                                            .Url(Url.Action("GetUserGroups", "UserManagement", new { area = "Admin", userId = Model.ParentID, orgId = Model.OrganisationID }))
                                                            .Reader(reader => reader.Add(Html.X().JsonReader().Root("data")))))
                                                                           )))

                                 ))
    )

        .TopBar(Html.X().Toolbar()
                    .Items(
                            Html.X().ToolbarFill(),
                            Html.X()
                            .Button()
                            .ApplyButtonDefaults(Razor.ApplySaveButtonDefaults).ID("EditUserSaveButton")
                            .DirectEvents(de =>
                                    {
                                        de.Click.Before = "return App.EditUserGroupForm.isValid();";
                                        de.Click.Url = Url.Action("EditUserGroupsAndRoles", "UserManagement", new { area = "Admin", userId = Model.ParentID, containerId = "AdministrationCenterPanel" });
                                        de.Click.ExtraParams.Add(new Parameter("roles", "App.SelectedRoles.getValues()", ParameterMode.Raw));
                                        de.Click.ExtraParams.Add(new Parameter("groups", "App.SelectedGroups.getValues()", ParameterMode.Raw));
                                        de.Click.Success = "Ext.Msg.show({" +
                                                            " title:   'Confirmation'," +
                                                            " msg:     'User roles and groups have been updated'," +
                                                            " buttons: Ext.Msg.OK," +
                                                            " icon:    Ext.MessageBox.Accept " +
                                                            " });";
                                        de.Click.FormID = "EditUserGroupForm";
                                    }),

                                                Html.X().Button().ApplyButtonDefaults(Razor.ApplyResetButtonDefaults).ID("EditUserResetButton").OnClientClick("App.EditUserGroupForm.getForm().reset();"),
                                                Html.X().Button().ApplyButtonDefaults(Razor.ApplyCancelButtonDefaults).ID("EditUserCancelButton")
                                            .DirectEvents(d =>
                                                    d.Click.Url = Url.Action("UserManagement", "UserManagement", new { area = "Admin", containerId = "AdministrationCenterPanel" })
                                            )
                                            )
                        )                                             
)                                 