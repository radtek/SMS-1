@using Ext.Net.MVC;
@using Ext.Net;
@using Bec.TargetFramework.Web.Framework.Extensions
@model Bec.TargetFramework.UI.Web.Areas.UserAccount.Models.PasswordResetInputModel
@{
    ViewBag.Title = "Reset Password";
    Layout = "~/Views/Shared/_BaseLayout.cshtml";
}


@section headTag
{
    <script>
        function checkPasswordResetForm() {
            if (App.PasswordResetForm.isValid()) {
                Ext.Msg.wait('Checking Email....', 'Password Reset');
            }
            else
                return false;
        }
    </script>
}

@section mainBody
{

    @(Html.X().Window()
    .ID("PasswordResetWindow")
    .Closable(false)
    .Resizable(false)
    .Height(120)
    .Width(300)
    .Icon(Icon.Lock)
    .Title("Password Recovery")
    .Layout(LayoutType.Fit)
    .Draggable(true)
    .Modal(true)
    .Padding(0)
    .Items
    (
        Html.X().FormPanel()
        .Padding(3)
        .Border(false)
        .Layout(LayoutType.Form)
        .ID("PasswordResetForm")
        .Url(Url.Action("Index", "PasswordReset", new { area = "UserAccount" }))
        .BodyStyle("background:transparent;")
        .Items
        (
            Html.X().AntiForgeryField(),
            Html.X().TextFieldFor(m => m.Email)
                .MsgTarget(MessageTarget.Side)
                .LabelAlign(LabelAlign.Right)
                .LabelWidth(45)
                
                .AllowBlank(false)
                .BlankText("Email is required")
                .AnchorHorizontal("100%")
        )
    )
    .Buttons
    (
    Html.X().Button().Text("Cancel")
        .Listeners(l => l.Click.Handler = "window.location = '" + Url.Action("Index", "Login", new { area = "UserAccount" }) + "'"),
        Html.X().Button()
            .Text("Reset Password")
            .Icon(Icon.Accept)
            .DirectEvents(de =>
            {
                de.Click.Timeout = 60000;
                de.Click.Url = Url.Action("Index", "PasswordReset", new { area = "UserAccount" });
                de.Click.FormID = "PasswordResetForm";
                de.Click.CleanRequest = true;
                de.Click.Method = HttpMethod.POST;
                de.Click.Before = "return checkPasswordResetForm();";
                de.Click.Failure = "Ext.Msg.show({" +
                           " title:   'Password Reset Error'," +
                           " msg:     result.errorMessage," +
                           " buttons: Ext.Msg.OK," +
                           " icon:    Ext.MessageBox.ERROR" +
                           " });";

                de.Click.EventMask.MinDelay = 250;
            })
    )
    )

}