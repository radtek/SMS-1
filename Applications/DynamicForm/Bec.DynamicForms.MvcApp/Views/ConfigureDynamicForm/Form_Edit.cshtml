@model Bec.DynamicForms.Models.FormModels

@{
    ViewBag.Title = "Form_Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section PageScripts {

    
   
    <script type="text/javascript" language="javascript">
        head.js("@Url.Content("~/Scripts/jquery/jquery.json-2.2.min.js")");

    function fnSaveForm() {
        if (document.getElementById('FormName').value == "") {
            alert("Please enter Form name");
            return false;
        }
        $('#loading').show();

        var categorieschkBox = document.getElementById('tblcategories')
        var options = categorieschkBox.getElementsByTagName('input');
        var contacts = "";
        for (var i = 0; i < options.length; i++) {

            if (options[i].checked) {
                var labelArray = options[i].id;
                if (contacts == "")
                    contacts += labelArray.replace("chk_","");
                else
                    contacts += '||' + labelArray.replace("chk_", "");

            }

        }
        var chkBox = document.getElementById('_chkFields')
        var options = chkBox.getElementsByTagName('input');
        var fields = "";
        for (var i = 0; i < options.length; i++) {

            if (options[i].checked) {
                var labelArray = options[i].parentNode.getElementsByTagName('label');
                if (fields == "")
                    fields += labelArray[0].innerHTML;
                else
                    fields += '||' + labelArray[0].innerHTML;

            }

        }        
        $.ajax(
               {
                  type: 'POST',
                  url: "@Url.Action("Form_Update", "ConfigureDynamicForm")",
                   data: $.toJSON({
                  FormId:$('#FormId').val(),
                  Name: $('#FormName').val(),
                  Description: $('#Description').val(),
                  ContactDetails:contacts ,
                  ContactFields:fields }),
                  success: function (data) {                     
                      
                },
                dataType: "json",
                contentType: 'application/json; charset=utf-8'
               });

        window.event.returnValue = false;
        document.location = '@Url.Action("Forms_Summary", "ConfigureDynamicForm")';

       

    }
 

</script>

}
<div id="fullcol">
    <div class="portlet rnd">
        <div class="portlet-header"><h2>Edit Forms</h2></div>
        <div class="portlet-content">


            @using (Html.BeginForm())
            {
                @Html.AntiForgeryToken()
    <table style="width:600px">

       
        <tr>
            <td colspan="2">

                @Html.ValidationSummary(true)
                @Html.HiddenFor(model=>model.FormId)
            </td>
        </tr>
        <tr>
            <td>Form Name <span class="style1">*</span> </td>
            <td>

                @Html.TextBoxFor(model => model.FormName, new { @class = "text", @style="width:400px" })
                @Html.ValidationMessageFor(model => model.FormName)
            </td>
        </tr>



        <tr>
            <td>
                Description
            </td>
            <td>
                @Html.TextAreaFor(model => model.Description, new { @class = "textarea", @style = "width:400px" })
                @Html.ValidationMessageFor(model => model.Description)

            </td>
        </tr>
        <tr>
            <td colspan="2"><b>Contact Fields</b> </td>
        </tr>
        <tr>
            <td colspan="2">
                <table id="_chkFields" border="0">
                    <tr>
                        <td><input id="chkName" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactFields,"Name") /><label for="_chkFields_0">Name</label></td>
                    </tr>
                    <tr>
                        <td><input id="chkProperty" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactFields, "Property Address") /><label for="_chkFields_1">Property Address</label></td>
                    </tr>
                    <tr>
                        <td><input id="chkCorrespondence" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactFields, "Correspondence Address") /><label for="_chkFields_2">Correspondence Address</label></td>
                    </tr>
                    <tr>
                        <td><input id="chkEmail" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactFields, "Email") /><label for="_chkFields_3">Email</label></td>
                    </tr>
                    <tr>
                        <td><input id="chkPhone" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactFields, "Phone") /><label for="_chkFields_4">Phone</label></td>
                    </tr>
                </table>
            </td>
        </tr>


        <tr>
            <td colspan="2">
                <b>Contact Details</b>
            </td>
        </tr>

        <tr>
            <td colspan="2">
                <table cellpadding="0" cellspacing="0" border="0" class="table" id="tblcategories">
                    @foreach (var item in Bec.DynamicForms.ServiceLayer.FormManager.SelectCategories())
                    {
                        <tr>
                            <td><input id="@("chk_" + item.CategoryId)" type="checkbox" @Bec.DynamicForms.ServiceLayer.Util.IsChecked(Model.ContactDetails, item.CategoryId.ToString()) /><label for="@("chk_" + item.CategoryId)">@item.Title</label> </td>
                        </tr>
                    }
                </table>
                
            </td>
        </tr>



        <tr>
            <td colspan="2">
                <a href="JavaScrip:void(-)" class="btn" onclick="fnSaveForm()">Save</a>|<a href="@Url.Action("Forms_Summary", "ConfigureDynamicForm")" class="btn">Cancel</a>        
            </td>
            <td colspan="2" style="float:left">
                <div id="loading" style="display: none;">
                    <img src="@Url.Content("~/Content/images/ajax-loader.gif")" /> Please wait.....
                </div>
            </td>
        </tr>
    </table>
            }

            <div>

            </div>
            </div></div></div>
           
